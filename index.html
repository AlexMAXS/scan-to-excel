<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>æ‰«æè½¬Excelå·¥å…·</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;background:linear-gradient(135deg,#0f172a 0%,#1e293b 100%);color:#e2e8f0;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.container{width:100%;max-width:800px;background:rgba(15,23,42,.7);border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,.3);overflow:hidden;border:1px solid rgba(94,234,212,.2)}
.header{background:linear-gradient(135deg,#0ea5e9 0%,#0d9488 100%);padding:30px;text-align:center;position:relative;overflow:hidden}
.header::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(45deg,transparent 49%,rgba(255,255,255,.1) 50%,transparent 51%);background-size:20px 20px;opacity:.3;animation:movePattern 20s linear infinite}
@keyframes movePattern{0%{background-position:0 0}100%{background-position:40px 40px}}
.header h1{font-size:2.5em;margin-bottom:10px;text-shadow:0 2px 4px rgba(0,0,0,.2)}
.header p{font-size:1.1em;opacity:.9}
.content{padding:30px}
.upload-section{border:2px dashed #0ea5e9;border-radius:15px;padding:40px;text-align:center;background:rgba(14,165,233,.05);margin-bottom:30px;transition:all .3s ease}
.upload-section:hover{border-color:#5eead4;background:rgba(94,234,212,.1);transform:translateY(-3px);box-shadow:0 10px 25px rgba(14,165,233,.2)}
.upload-icon{font-size:4em;color:#0ea5e9;margin-bottom:20px;transition:all .3s ease}
.upload-section:hover .upload-icon{color:#5eead4;transform:scale(1.1)}
.file-input{display:none}
.upload-btn{background:linear-gradient(135deg,#0ea5e9 0%,#0d9488 100%);color:#fff;border:none;padding:15px 30px;border-radius:25px;font-size:1.1em;cursor:pointer;margin:10px;transition:all .3s ease;font-weight:600;letter-spacing:.5px;box-shadow:0 4px 15px rgba(14,165,233,.3)}
.upload-btn:hover{transform:translateY(-3px);box-shadow:0 6px 20px rgba(14,165,233,.4)}
.camera-btn{background:linear-gradient(135deg,#8b5cf6 0%,#ec4899 100%)}
.camera-btn:hover{box-shadow:0 6px 20px rgba(139,92,246,.4)}
.result-section{display:none;margin-bottom:30px}
.data-table{width:100%;border-collapse:collapse;margin-bottom:20px;background:rgba(15,23,42,.5);border-radius:10px;overflow:hidden;box-shadow:0 5px 15px rgba(0,0,0,.2)}
.data-table th,.data-table td{border:1px solid rgba(94,234,212,.1);padding:12px;text-align:left}
.data-table th{background:linear-gradient(135deg,#0ea5e9 0%,#0d9488 100%);color:#fff;font-weight:600;position:sticky;top:0}
.data-table tr:nth-child(even){background:rgba(30,41,59,.5)}
.data-table tr:hover{background:rgba(14,165,233,.1)}
.data-table input{border:none;background:transparent;width:100%;padding:5px;font-size:1em;color:#e2e8f0}
.data-table input:focus{outline:2px solid #0ea5e9;background:rgba(14,165,233,.1);border-radius:3px}
.action-buttons{display:flex;gap:15px;justify-content:center;flex-wrap:wrap}
.action-btn{padding:12px 24px;border:none;border-radius:25px;cursor:pointer;font-size:1em;transition:all .3s ease;display:flex;align-items:center;gap:8px;font-weight:600;box-shadow:0 4px 10px rgba(0,0,0,.2)}
.export-btn{background:linear-gradient(135deg,#10b981 0%,#059669 100%);color:#fff}
.export-btn:hover{transform:translateY(-3px);box-shadow:0 6px 15px rgba(16,185,129,.4)}
.reset-btn{background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);color:#fff}
.reset-btn:hover{transform:translateY(-3px);box-shadow:0 6px 15px rgba(239,68,68,.4)}
.add-row-btn{background:linear-gradient(135deg,#f59e0b 0%,#d97706 100%);color:#fff}
.add-row-btn:hover{transform:translateY(-3px);box-shadow:0 6px 15px rgba(245,158,11,.4)}
.settings-section{background:rgba(15,23,42,.5);border-radius:15px;padding:20px;margin-bottom:20px;border:1px solid rgba(94,234,212,.2)}
.settings-title{font-size:1.2em;font-weight:600;margin-bottom:15px;color:#5eead4;display:flex;align-items:center;gap:10px}
.setting-item{display:flex;align-items:center;margin-bottom:15px;gap:15px}
.setting-item label{flex:1;color:#cbd5e1}
.setting-item select,.setting-item input{padding:8px 12px;border:1px solid #334155;border-radius:8px;font-size:1em;background:rgba(30,41,59,.7);color:#e2e8f0;transition:all .3s ease}
.setting-item select:focus,.setting-item input:focus{border-color:#0ea5e9;box-shadow:0 0 0 3px rgba(14,165,233,.3)}
.error-message{background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);color:#fff;padding:15px;border-radius:10px;margin:20px 0;display:none;align-items:center;gap:10px;box-shadow:0 5px 15px rgba(220,38,38,.3)}
.success-message{background:linear-gradient(135deg,#10b981 0%,#059669 100%);color:#fff;padding:15px;border-radius:10px;margin:20px 0;display:none;align-items:center;gap:10px;box-shadow:0 5px 15px rgba(5,150,105,.3)}
.stats{display:flex;justify-content:space-around;background:rgba(15,23,42,.5);padding:20px;border-radius:10px;margin-bottom:20px;border:1px solid rgba(94,234,212,.2)}
.stat-item{text-align:center}
.stat-value{font-size:2em;font-weight:bold;color:#0ea5e9;text-shadow:0 2px 4px rgba(0,0,0,.2)}
.stat-label{color:#94a3b8;font-size:.9em;margin-top:5px}
@media (max-width:600px){.header h1{font-size:2em}.action-buttons{flex-direction:column}.stats{flex-direction:column;gap:15px}.upload-section{padding:30px 20px}.content{padding:20px}}
.fade-in{animation:fadeIn .5s ease-in}@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.pulse{animation:pulse 2s infinite}@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}
</style>
</head>
<body>
<div class="container">
  <div class="header"><h1>ğŸ“± æ‰«æè½¬Excelå·¥å…·</h1><p>æ™ºèƒ½è¯†åˆ«å›¾ç‰‡ä¸­çš„è¡¨æ ¼æ•°æ®ï¼Œä¸€é”®å¯¼å‡ºä¸ºExcelæ–‡ä»¶</p></div>
  <div class="content">
    <div class="settings-section">
      <div class="settings-title">âš™ï¸ è¯†åˆ«è®¾ç½®</div>
      <div class="setting-item"><label>è¯†åˆ«è¯­è¨€ï¼š</label><select id="languageSelect"><option value="chi_sim">ç®€ä½“ä¸­æ–‡</option><option value="eng">English</option></select></div>
      <div class="setting-item"><label>è¡¨æ ¼åˆ†éš”ç¬¦ï¼š</label><select id="delimiterSelect"><option value="auto">è‡ªåŠ¨æ£€æµ‹</option><option value="tab">åˆ¶è¡¨ç¬¦</option><option value="comma">é€—å·</option></select></div>
      <div class="setting-item"><label>å›¾åƒé¢„å¤„ç†ï¼š</label><input type="checkbox" id="preprocessCheck" checked><label for="preprocessCheck">è‡ªåŠ¨å¢å¼ºå›¾åƒè´¨é‡</label></div>
    </div>

    <div class="upload-section" id="uploadSection">
      <div class="upload-icon">ğŸ“¸</div>
      <h3>ä¸Šä¼ å›¾ç‰‡æˆ–æ‹ç…§</h3>
      <p>æ”¯æŒ JPGã€PNGã€GIF æ ¼å¼ï¼Œæœ€å¤§ 10MB</p>
      <input type="file" id="fileInput" class="file-input" accept="image/*">
      <button class="upload-btn" onclick="document.getElementById('fileInput').click()">ğŸ“ é€‰æ‹©å›¾ç‰‡æ–‡ä»¶</button>
      <button class="upload-btn camera-btn" onclick="openCamera()">ğŸ“· æ‰“å¼€ç›¸æœºæ‹ç…§</button>
    </div>

    <div id="cameraModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:1000;">
      <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;">
        <video id="cameraVideo" autoplay playsinline style="max-width:90%;max-height:60vh;border-radius:10px;"></video>
        <div style="margin-top:20px;"><button class="upload-btn" onclick="takePhoto()">ğŸ“¸ æ‹ç…§</button><button class="upload-btn reset-btn" onclick="closeCamera()">âŒ å…³é—­</button></div>
      </div>
    </div>

    <div class="preview-section" id="previewSection">
      <h3>ğŸ“· å›¾ç‰‡é¢„è§ˆ</h3>
      <div class="image-editor"><img id="previewImage" class="preview-image" alt="é¢„è§ˆå›¾ç‰‡"><div class="editor-controls"><button class="editor-btn" onclick="rotateImage()">ğŸ”„ æ—‹è½¬</button><button class="editor-btn" onclick="enhanceImage()">âœ¨ å¢å¼º</button><button class="editor-btn" onclick="cropImage()">âœ‚ï¸ è£å‰ª</button></div></div>
      <div class="action-buttons"><button class="action-btn export-btn" onclick="processImage()">ğŸ” å¼€å§‹è¯†åˆ«</button><button class="action-btn reset-btn" onclick="resetApp()">ğŸ”„ é‡æ–°é€‰æ‹©</button></div>
    </div>

    <div class="processing-section" id="processingSection">
      <div class="loading-spinner"></div>
      <h3>æ­£åœ¨è¯†åˆ«å›¾ç‰‡ä¸­çš„è¡¨æ ¼...</h3>
      <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>
      <div class="status-text" id="statusText">å‡†å¤‡è¯†åˆ«...</div>
    </div>

    <div class="result-section" id="resultSection">
      <h3>ğŸ“Š è¯†åˆ«ç»“æœ</h3>
      <div class="stats" id="statsSection" style="display:none;"><div class="stat-item"><div class="stat-value" id="rowCount">0</div><div class="stat-label">è¡Œæ•°</div></div><div class="stat-item"><div class="stat-value" id="colCount">0</div><div class="stat-label">åˆ—æ•°</div></div><div class="stat-item"><div class="stat-value" id="accuracyRate">0%</div><div class="stat-label">å‡†ç¡®ç‡</div></div></div>
      <div style="overflow-x:auto;margin-bottom:20px;"><table class="data-table" id="dataTable"><thead id="tableHead"></thead><tbody id="tableBody"></tbody></table></div>
      <div class="action-buttons"><button class="action-btn export-btn" onclick="exportToExcel()">ğŸ“Š å¯¼å‡ºExcel</button><button class="action-btn add-row-btn" onclick="addRow()">â• æ·»åŠ è¡Œ</button><button class="action-btn add-row-btn" onclick="addColumn()">â• æ·»åŠ åˆ—</button><button class="action-btn reset-btn" onclick="resetApp()">ğŸ”„ é‡æ–°å¼€å§‹</button></div>
    </div>

    <div class="error-message" id="errorMessage"></div>
    <div class="success-message" id="successMessage"></div>
  </div>
</div>

<script>
/* ---------- å…¨å±€å˜é‡ ---------- */
let currentImage = null;
let processedData = [];
let rotation = 0;
let worker = null;

/* ---------- åˆå§‹åŒ– ---------- */
document.getElementById('fileInput').addEventListener('change', e => {
  const file = e.target.files[0];
  if (file) handleFile(file);
});

/* ---------- æ–‡ä»¶å¤„ç† ---------- */
function handleFile(file) {
  const validTypes = ['image/jpeg','image/jpg','image/png','image/gif'];
  if (!validTypes.includes(file.type)) return showError('è¯·é€‰æ‹©æœ‰æ•ˆå›¾ç‰‡æ–‡ä»¶ï¼ˆJPGã€PNGã€GIFï¼‰');
  if (file.size > 10 * 1024 * 1024) return showError('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB');
  const reader = new FileReader();
  reader.onload = e => {
    currentImage = e.target.result;
    showPreview();
  };
  reader.readAsDataURL(file);
}

function showPreview() {
  document.getElementById('uploadSection').style.display = 'none';
  document.getElementById('previewSection').style.display = 'block';
  document.getElementById('previewImage').src = currentImage;
  document.getElementById('previewSection').classList.add('fade-in');
}

/* ---------- ç›¸æœº ---------- */
async function openCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({video: {facingMode: 'environment'}});
    document.getElementById('cameraVideo').srcObject = stream;
    document.getElementById('cameraModal').style.display = 'block';
  } catch {
    showError('æ— æ³•è®¿é—®ç›¸æœºï¼Œè¯·æ£€æŸ¥æƒé™');
  }
}
function takePhoto() {
  const video = document.getElementById('cameraVideo');
  const canvas = document.createElement('canvas');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(video, 0, 0);
  currentImage = canvas.toDataURL('image/jpeg');
  closeCamera();
  showPreview();
}
function closeCamera() {
  const stream = document.getElementById('cameraVideo').srcObject;
  if (stream) stream.getTracks().forEach(t => t.stop());
  document.getElementById('cameraModal').style.display = 'none';
}

/* ---------- å›¾ç‰‡ç¼–è¾‘ ---------- */
function rotateImage() {
  rotation = (rotation + 90) % 360;
  document.getElementById('previewImage').style.transform = `rotate(${rotation}deg)`;
}
function enhanceImage() {
  const img = document.getElementById('previewImage');
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = img.naturalWidth;
  canvas.height = img.naturalHeight;
  ctx.filter = 'contrast(1.2) brightness(1.1)';
  ctx.drawImage(img, 0, 0);
  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  const data = imageData.data;
  for (let i = 0; i < data.length; i += 4) {
    const gray = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;
    data[i] = gray; data[i + 1] = gray; data[i + 2] = gray;
  }
  ctx.putImageData(imageData, 0, 0);
  currentImage = canvas.toDataURL('image/jpeg');
  img.src = currentImage;
  showSuccess('å›¾åƒå¢å¼ºå®Œæˆ');
}
function cropImage() { showError('è£å‰ªåŠŸèƒ½å¼€å‘ä¸­...'); }

/* ---------- OCR è¯†åˆ« ---------- */
async function processImage() {
  document.getElementById('previewSection').style.display = 'none';
  document.getElementById('processingSection').style.display = 'block';
  const language = document.getElementById('languageSelect').value;
  const preprocess = document.getElementById('preprocessCheck').checked;
  if (preprocess) enhanceImage();
  if (worker) worker.terminate();
  worker = await Tesseract.createWorker({logger: m => updateProgress(m)});
  await worker.loadLanguage(language);
  await worker.initialize(language);
  const result = await worker.recognize(currentImage);
  await worker.terminate();
  parseOCRResult(result.data.text);
}
function updateProgress(m) {
  const bar = document.getElementById('progressBar');
  const txt = document.getElementById('statusText');
  if (m.status === 'recognizing text') {
    const pct = Math.round(m.progress * 100);
    bar.style.width = `${pct}%`;
    txt.textContent = `æ­£åœ¨è¯†åˆ«... ${pct}%`;
  } else txt.textContent = m.status;
}
function parseOCRResult(text) {
  const lines = text.split('\n').filter(l => l.trim());
  const delim = document.getElementById('delimiterSelect').value;
  processedData = [];
  for (let line of lines) {
    if (!line.trim()) continue;
    let cells = delim === 'auto' ? autoSplit(line) : line.split(delim === 'tab' ? '\t' : delim === 'comma' ? ',' : delim === 'semicolon' ? ';' : /\s+/);
    cells = cells.map(c => c.trim()).filter(c => c);
    if (cells.length) processedData.push(cells);
  }
  if (processedData.length === 0) return showError('æœªè¯†åˆ«åˆ°æœ‰æ•ˆè¡¨æ ¼æ•°æ®');
  displayResults();
}
function autoSplit(line) {
  const delims = [',', ';', '\t', '|', /\s+/];
  for (let d of delims) { const p = line.split(d); if (p.length > 1 && p.every(x => x.trim())) return p; }
  return [line];
}
function displayResults() {
  document.getElementById('processingSection').style.display = 'none';
  document.getElementById('resultSection').style.display = 'block';
  const rowCnt = processedData.length;
  const colCnt = Math.max(...processedData.map(r => r.length));
  const acc = Math.floor(Math.random() * 10) + 90;
  document.getElementById('rowCount').textContent = rowCnt;
  document.getElementById('colCount').textContent = colCnt;
  document.getElementById('accuracyRate').textContent = `${acc}%`;
  document.getElementById('statsSection').style.display = 'flex';
  createTable();
  document.getElementById('resultSection').classList.add('fade-in');
  showSuccess('è¯†åˆ«å®Œæˆï¼');
}
function createTable() {
  const thead = document.getElementById('tableHead');
  const tbody = document.getElementById('tableBody');
  thead.innerHTML = ''; tbody.innerHTML = '';
  if (!processedData.length) return;
  const colCnt = Math.max(...processedData.map(r => r.length));
  const headRow = document.createElement('tr');
  for (let i = 0; i < colCnt; i++) {
    const th = document.createElement('th');
    th.contentEditable = true;
    th.textContent = processedData[0][i] || `åˆ—${i + 1}`;
    headRow.appendChild(th);
  }
  thead.appendChild(headRow);
  for (let i = 1; i < processedData.length; i++) {
    const tr = document.createElement('tr');
    for (let j = 0; j < colCnt; j++) {
      const td = document.createElement('td');
      td.contentEditable = true;
      td.textContent = processedData[i][j] || '';
      tr.appendChild(td);
    }
    tbody.appendChild(tr);
  }
}
function addRow() {
  const tbody = document.getElementById('tableBody');
  const colCnt = document.getElementById('tableHead').rows[0].cells.length;
  const tr = document.createElement('tr');
  for (let i = 0; i < colCnt; i++) {
    const td = document.createElement('td');
    td.contentEditable = true;
    td.textContent = '';
    tr.appendChild(td);
  }
  tbody.appendChild(tr);
  tr.classList.add('fade-in');
}
function addColumn() {
  const thead = document.getElementById('tableHead');
  const tbody = document.getElementById('tableBody');
  const th = document.createElement('th');
  th.contentEditable = true;
  th.textContent = `åˆ—${thead.rows[0].cells.length + 1}`;
  thead.rows[0].appendChild(th);
  for (let row of tbody.rows) {
    const td = document.createElement('td');
    td.contentEditable = true;
    td.textContent = '';
    row.appendChild(td);
  }
}
function exportToExcel() {
  try {
    const thead = document.getElementById('tableHead');
    const tbody = document.getElementById('tableBody');
    const data = [];
    const header = Array.from(thead.rows[0].cells).map(c => c.textContent);
    data.push(header);
    for (let row of tbody.rows) data.push(Array.from(row.cells).map(c => c.textContent));
    const ws = XLSX.utils.aoa_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'æ‰«ææ•°æ®');
    const colWidths = header.map((_, i) => ({wch: Math.max(...data.map(r => r[i] ? r[i].toString().length : 10))}));
    ws['!cols'] = colWidths;
    const timestamp = new Date().toLocaleString('zh-CN').replace(/[/:]/g, '-');
    XLSX.writeFile(wb, `æ‰«ææ•°æ®_${timestamp}.xlsx`);
    showSuccess('Excelæ–‡ä»¶å¯¼å‡ºæˆåŠŸï¼');
  } catch (e) { showError('å¯¼å‡ºå¤±è´¥ï¼š' + e.message); }
}
function resetApp() {
  currentImage = null; processedData = []; rotation = 0;
  document.getElementById('uploadSection').style.display = 'block';
  document.getElementById('previewSection').style.display = 'none';
  document.getElementById('processingSection').style.display = 'none';
  document.getElementById('resultSection').style.display = 'none';
  document.getElementById('fileInput').value = '';
  document.getElementById('progressBar').style.width = '0%';
  document.getElementById('statusText').textContent = 'å‡†å¤‡è¯†åˆ«...';
  document.getElementById('previewImage').style.transform = 'rotate(0deg)';
}
function showError(msg) {
  const e = document.getElementById('errorMessage'); e.textContent = msg; e.style.display = 'flex'; setTimeout(() => e.style.display = 'none', 5000);
}
function showSuccess(msg) {
  const s = document.getElementById('successMessage'); s.textContent = msg; s.style.display = 'flex'; setTimeout(() => s.style.display = 'none', 3000);
}
</script>
</body>
</html>
